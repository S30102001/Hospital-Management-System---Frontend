<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Cairo", sans-serif;
        background-color: #f7fdfd;
        direction: rtl;
        padding: 30px;
        margin: 0;
      }

      .container {
        background: white;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        max-width: 800px;
        margin: auto;
      }

      h2 {
        color: #007bff;
        text-align: center;
        margin-bottom: 30px;
        font-size: 28px;
      }

      label {
        font-weight: bold;
      }

      .hidden {
        display: none;
      }

      @media (max-width: 768px) {
        body {
          padding: 15px;
        }

        .container {
          padding: 20px;
          border-radius: 15px;
        }

        h2 {
          font-size: 24px;
        }

        label {
          font-size: 15px;
        }

        .form-control {
          font-size: 14px;
        }

        .btn {
          font-size: 16px;
          padding: 10px;
        }
      }

      @media (max-width: 480px) {
        h2 {
          font-size: 22px;
        }

        label {
          font-size: 14px;
        }

        .btn {
          font-size: 15px;
          padding: 9px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2 id="formTitle">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>

      <form id="editForm">
        <div id="sharedFields">
          <div class="form-group">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
            <input type="text" class="form-control" id="name" required />
          </div>
        </div>

        <!-- Doctor fields -->
        <div id="doctorFields" class="hidden">
          <div class="form-group">
            <label>Ø§Ù„ØªØ®ØµØµ</label>
            <input type="text" class="form-control" id="specialization" />
          </div>
          <div class="form-group">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
            <input type="date" class="form-control" id="birthDate" />
          </div>
          <div class="form-group">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ®Ø±Ø¬</label>
            <input type="date" class="form-control" id="gradDate" />
          </div>
        </div>

        <!-- Nurse fields -->
        <div id="nurseFields" class="hidden">
          <div class="form-group">
            <label>Ø§Ù„Ù‚Ø³Ù…</label>
            <input type="text" class="form-control" id="department" />
          </div>
          <div class="form-group">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
            <input type="date" class="form-control" id="birthDate" />
          </div>
          <div class="form-group">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</label>
            <input type="date" class="form-control" id="hiringDate" />
          </div>
        </div>

        <!-- Patient fields -->
        <div id="patientFields" class="hidden">
          <div class="form-group">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
            <input type="date" class="form-control" id="birthDate" />
          </div>
          <div class="form-group">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
            <input type="date" class="form-control" id="admissionDate" />
          </div>
          <div class="form-group">
            <label>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ©</label>
            <input type="text" class="form-control" id="healthStatus" />
          </div>
          <div class="form-group">
            <label>Ø§Ù„ØªØ´Ø®ÙŠØµ</label>
            <input type="text" class="form-control" id="diagnosis" />
          </div>
          <div class="form-group">
            <label>Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©</label>
            <select class="form-control" id="roomNumber">
              <option value="">Ø§Ø®ØªØ± Ø§Ù„ØºØ±ÙØ©</option>
              <option value="101">101</option>
              <option value="102">102</option>
              <option value="ICU">ICU</option>
            </select>
          </div>
        </div>

        <!-- Common to all -->
        <div class="form-group">
          <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input type="text" class="form-control" id="phone" />
        </div>

        <div class="form-group">
          <label>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
          <input type="email" class="form-control" id="email" />
        </div>

        <button type="submit" class="btn btn-primary btn-block mt-4">
          ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
        </button>
      </form>
    </div>

    <script>
      const type = localStorage.getItem("editType");
      const index = localStorage.getItem("editIndex");
      let data = JSON.parse(localStorage.getItem(type) || "[]");

      if (!type || index === null || !data[index]) {
        alert("âš ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©.");
        window.location.href = "records.html";
      }

      const person = data[index];
      document.getElementById("name").value = person.name || "";
      document.getElementById("phone").value = person.phone || "";
      document.getElementById("email").value = person.email || "";

      document.getElementById("formTitle").innerText = `ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ${
        type === "doctors" ? "Ø·Ø¨ÙŠØ¨" : type === "nurses" ? "Ù…Ù…Ø±Ø¶" : "Ù…Ø±ÙŠØ¶"
      }`;

      if (type === "doctors") {
        document.getElementById("doctorFields").classList.remove("hidden");
        document.getElementById("specialization").value =
          person.specialization || "";
        document.getElementById("birthDate").value = person.birthDate || "";
        document.getElementById("gradDate").value = person.gradDate || "";
      } else if (type === "nurses") {
        document.getElementById("nurseFields").classList.remove("hidden");
        document.getElementById("department").value = person.department || "";
        document.getElementById("birthDate").value = person.birthDate || "";
        document.getElementById("hiringDate").value = person.hiringDate || "";
      } else if (type === "patients") {
        document.getElementById("patientFields").classList.remove("hidden");
        document.getElementById("birthDate").value = person.birthDate || "";
        document.getElementById("admissionDate").value =
          person.admissionDate || "";
        document.getElementById("healthStatus").value =
          person.healthStatus || "";
        document.getElementById("diagnosis").value = person.diagnosis || "";
        document.getElementById("roomNumber").value = person.roomNumber || "";
      }

      document
        .getElementById("editForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const updated = {
            name: document.getElementById("name").value,
            phone: document.getElementById("phone").value,
            email: document.getElementById("email").value,
          };

          if (type === "doctors") {
            Object.assign(updated, {
              specialization: document.getElementById("specialization").value,
              birthDate: document.getElementById("birthDate").value,
              gradDate: document.getElementById("gradDate").value,
            });
          } else if (type === "nurses") {
            Object.assign(updated, {
              department: document.getElementById("department").value,
              birthDate: document.getElementById("birthDate").value,
              hiringDate: document.getElementById("hiringDate").value,
            });
          } else if (type === "patients") {
            Object.assign(updated, {
              birthDate: document.getElementById("birthDate").value,
              admissionDate: document.getElementById("admissionDate").value,
              healthStatus: document.getElementById("healthStatus").value,
              diagnosis: document.getElementById("diagnosis").value,
              roomNumber: document.getElementById("roomNumber").value,
            });
          }

          data[index] = updated;
          localStorage.setItem(type, JSON.stringify(data));
          alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
          window.location.href = "records.html";
        });
    </script>
  </body>
</html>
